## user

| 字段名       | 字段类型     | 说明             |
| ------------ | ------------ | ---------------- |
| id           | bigint       | 主键             |
| username     | varchar(50)  | 用户名（唯一）   |
| password     | varchar(100) | 密码（加密存储） |
| nickname     | varchar(50)  | 昵称             |
| created_time | datetime     | 注册/创建时间    |

## list_group

| 字段名       | 字段类型     | 说明                                                         |
| ------------ | ------------ | ------------------------------------------------------------ |
| id           | bigint       | 主键                                                         |
| name         | varchar(100) | 清单分组的名称                                               |
| user_id      | bigint       | 所属用户id，一个用户可有多个list_group清单分组               |
| is_default   | boolean      | 是否为默认的清单分组，在用户注册时会建立默认清单分组，无法删除 |
| created_time | datetime     | 注册/创建时间                                                |

## list

| 字段名        | 字段类型     | 说明                                                         |
| ------------- | ------------ | ------------------------------------------------------------ |
| id            | bigint       | 主键                                                         |
| name          | varchar(100) | 清单的名称                                                   |
| user_id       | bigint       | 所属用户id                                                   |
| list_group_id | bigint       | 所属清单分组id                                               |
| is_default    | boolean      | 是否为默认的清单，在用户注册时会建立默认清单分组下的默认清单，无法删除 |
| created_time  | datetime     | 注册/创建时间                                                |

## task_group

| 字段名       | 字段类型     | 说明                                                         |
| ------------ | ------------ | ------------------------------------------------------------ |
| id           | bigint       | 主键                                                         |
| name         | varchar(100) | 任务分组的名称                                               |
| list_id      | bigint       | 所属清单id                                                   |
| is_default   | boolean      | 是否为默认的任务分组，在用户注册时会建立默认清单分组下的默认清单下的默认任务分组，无法删除 |
| created_time | datetime     | 注册/创建时间                                                |

## task

| 字段名        | 字段类型     | 说明                                                         |
| ------------- | ------------ | ------------------------------------------------------------ |
| id            | bigint       | PK                                                           |
| user_id       | bigint       | 用户 ID                                                      |
| list_group_id | bigint       | 所属清单分组 ID                                              |
| list_id       | bigint       | 所属清单 ID                                                  |
| task_group_id | bigint       | 所属任务分组 ID                                              |
| parent_id     | bigint       | 直接父 ID (顶级为 0)                                         |
| path          | varchar(512) | 路径字符串：如 "0/1/5/12/" (包含所有祖先 ID，加索引)         |
| level         | int          | 当前层级，1 为根任务                                         |
| sort_order    | double       | 用于同级任务的排序。使用 `DOUBLE` 类型可以实现在两个任务之间插入新任务而无需重新计算整层的排序值。 |
| name          | varchar(255) | 任务名字                                                     |
| content       | text         | 任务详情/描述                                                |
| status        | tinyint      | 状态 （0-2）默认0；0指待完成，1指已完成，2指已截止           |
| priority      | tinyint      | 优先级 (1-3)                                                 |
| created_at    | datetime     | 创建时间                                                     |
| updated_at    | datetime     | 更新时间                                                     |
| completed_at  | datetime     | 完成时间                                                     |
| due_time      | datetime     | 截止时间                                                     |

## activity_log

| 字段          | 类型         | 说明                                                       |
| ------------- | ------------ | ---------------------------------------------------------- |
| id            | bigint       | PK                                                         |
| user_id       | bigint       | 操作用户 ID                                                |
| username      | varchar(50)  | 用户快照名 (可选)                                          |
| entity_type   | tinyint      | 0-list_group，1-list，2-task_group，3-task；操作的实体类型 |
| list_group_id | bigint       | 清单分组 ID                                                |
| lg_name       | varchar(100) | 清单分组快照名                                             |
| list_id       | bigint       | 清单 ID                                                    |
| list_name     | varchar(100) | 清单快照名                                                 |
| tg_id         | bigint       | 任务分组 ID                                                |
| tg_name       | varchar(100) | 任务分组快照名                                             |
| task_id       | bigint       | 任务 ID                                                    |
| task_name     | varchar(255) | 任务标题名快照                                             |
| action        | tinyint      | 操作类型 (0-CREATE, 1-DELETE, 2-COMPLETE, 3-UPDATE)        |
| created_at    | datetime     | 发生时间                                                   |

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS `smart_todo` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE `smart_todo`;

-- 1. 用户表
CREATE TABLE `user` (
	`id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
	`username` VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
	`password` VARCHAR(100) NOT NULL COMMENT '加密存储的密码',
	`nickname` VARCHAR(50) DEFAULT NULL COMMENT '用户昵称',
	`avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
	`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间'
) ENGINE=InnoDB COMMENT='用户表';

-- 2. 清单分组表
CREATE TABLE `list_group` (
	`id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
	`user_id` BIGINT UNSIGNED NOT NULL COMMENT '所属用户ID',
	`name` VARCHAR(100) NOT NULL COMMENT '分组名称',
	`sort_order` DOUBLE NOT NULL DEFAULT 0 COMMENT '排序值',
	`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	INDEX `idx_user_sort` (`user_id`, `sort_order`)
) ENGINE=InnoDB COMMENT='清单分组表';

-- 3. 清单表
CREATE TABLE `list` (
	`id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
	`user_id` BIGINT UNSIGNED NOT NULL COMMENT '所属用户ID',
	`list_group_id` BIGINT UNSIGNED NOT NULL COMMENT '所属清单分组ID',
	`name` VARCHAR(100) NOT NULL COMMENT '清单名称',
	`sort_order` DOUBLE NOT NULL DEFAULT 0 COMMENT '排序值',
	`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	INDEX `idx_group_sort` (`list_group_id`, `sort_order`),
	INDEX `idx_user_list` (`user_id`)
) ENGINE=InnoDB COMMENT='清单表';

-- 4. 任务分组表
CREATE TABLE `task_group` (
	`id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
	`list_id` BIGINT UNSIGNED NOT NULL COMMENT '所属清单ID',
	`name` VARCHAR(100) NOT NULL COMMENT '任务分组名称',
	`sort_order` DOUBLE NOT NULL DEFAULT 0 COMMENT '排序值',
	`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	INDEX `idx_list_sort` (`list_id`, `sort_order`)
) ENGINE=InnoDB COMMENT='任务分组表';

-- 5. 任务表
CREATE TABLE `task` (
	`id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
	`user_id` BIGINT UNSIGNED NOT NULL COMMENT '所属用户ID (隔离校验)',
	`list_id` BIGINT UNSIGNED NOT NULL COMMENT '所属清单ID (核心查询维度)',
	`task_group_id` BIGINT UNSIGNED DEFAULT NULL COMMENT '所属任务分组ID',
	`parent_id` BIGINT UNSIGNED DEFAULT NULL COMMENT '直接父ID (顶级为NULL)',
	`path` VARCHAR(512) NOT NULL DEFAULT '' COMMENT '路径枚举,如 "0/1/5/"',
	`level` INT NOT NULL DEFAULT 1 COMMENT '递归深度,1为根任务',
	`name` VARCHAR(255) NOT NULL COMMENT '任务标题',
	`content` TEXT COMMENT '任务详情',
	`sort_order` DOUBLE NOT NULL DEFAULT 0 COMMENT '同级排序值 (双精度取中算法)',
	`status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态: 0-待办, 1-完成, 2-已过期',
	`priority` TINYINT NOT NULL DEFAULT 0 COMMENT '优先级: 0-无, 1-低, 2-中, 3-高',
	`due_at` DATETIME DEFAULT NULL COMMENT '截止时间',
	`completed_at` DATETIME DEFAULT NULL COMMENT '完成时间',
	`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	`updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
	`is_deleted` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '软删除标记: 0-正常, 1-回收站',

    -- 核心组合索引：优化清单内任务展示
	INDEX `idx_query_composite` (`list_id`, `task_group_id`, `sort_order`),
    -- 索引：优化子任务懒加载查询
	INDEX `idx_parent_id` (`parent_id`),
    -- 索引：优化路径查询（前缀索引）
	INDEX `idx_path_prefix` (`path`(255)),
    -- 索引：优化过期任务扫描或个人任务聚合
	INDEX `idx_user_status_due` (`user_id`, `status`, `due_at`)
) ENGINE=InnoDB COMMENT='任务表';

-- 6. 活动日志表
CREATE TABLE `activity_log` (
	`id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
	`user_id` BIGINT UNSIGNED NOT NULL COMMENT '执行用户ID',
	`entity_id` BIGINT UNSIGNED NOT NULL COMMENT '操作实体ID',
	`entity_type` TINYINT NOT NULL COMMENT '实体类型: 0-分组, 1-清单, 2-任务组, 3-任务',
	`action` TINYINT NOT NULL COMMENT '操作类型: 0-创建, 1-删除, 2-完成, 3-修改, 4-移动',
	`summary` VARCHAR(255) DEFAULT NULL COMMENT '操作简述快照',
	`extra_data` JSON DEFAULT NULL COMMENT '详细快照或差异数据 (JSON格式)',
	`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '日志记录时间',
	INDEX `idx_user_activity` (`user_id`, `created_at`),
	INDEX `idx_entity_log` (`entity_id`, `entity_type`)
) ENGINE=InnoDB COMMENT='操作日志表';
```

